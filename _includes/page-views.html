<script>
(function() {
  const database = firebase.database();
  const pageUrl = window.location.pathname;

  <!-- Convert URL to a Firebase-safe key. -->
  const pageKey = pageUrl.split('/').join('_').replace(/[.$#\[\]]/g, '');
  const pageRef = database.ref('views/' + pageKey);

  function renderViews(value) {
    const viewElement = document.getElementById('page-views-count');
    if (viewElement) {
      viewElement.textContent = Number(value || 0).toLocaleString();
    }
  }

  pageRef.transaction(
    function(currentViews) {
      return (currentViews || 0) + 1;
    },
    function(error, committed, snapshot) {
      if (!error && committed && snapshot) {
        renderViews(snapshot.val());
        return;
      }

      pageRef.once('value').then(function(fallbackSnapshot) {
        renderViews(fallbackSnapshot.val());
      });
    }
  );
})();
</script>

<span class="page-views">
  <i class="fas fa-eye"></i>
  <span id="page-views-count">-</span>
  views
</span>

<style>
.page-views {
  display: inline-flex;
  align-items: center;
  gap: 0.3rem;
  color: var(--text-muted-color, #666);
  font-size: 0.9rem;
}

.page-views i {
  color: var(--text-muted-color, #999);
  font-size: 0.9em;
}

/* Dark mode */
[data-mode="dark"] .page-views {
  color: #aaa;
}

[data-mode="dark"] .page-views i {
  color: #888;
}
</style>
